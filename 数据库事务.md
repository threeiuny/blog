---
title: 数据库事务
date: 2023-11-11 18:16:05
tags: [数据库, 事务]
---

## 什么是数据库事务以及为什么需要事务

事务（Transaction）是指数据库管理系统执行的一个或一组操作单元，这些操作要么全部执行成功，要么全部不执行，即事务具有原子性（Atomicity）。事务是确保数据一致性和完整性的一种机制。

数据库事务是指数据库系统中执行的一系列相关的操作，这些操作被视为一个逻辑单元，要么全部执行成功，要么全部执行失败，没有中间状态。数据库事务通常涉及对数据库中的数据进行读写操作，例如插入、更新、删除等。

数据库事务的存在是为了确保数据的一致性、完整性和可靠性。

### 数据库事务的特性（ACID）

数据库事务具有以下四个特性，分别是原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability），通常称为事务的 ACID 特性。

* 原子性（Atomicity）：事务是一个不可分割的工作单元，要么全部执行成功，要么全部不执行。如果事务的任何部分操作失败，整个事务将被回滚，恢复到最初的状态。请注意，原子性并不意味着一个事务的操作无法被另一个事务打断，在并发环境下，多个事务可能会交错执行，调度器会根据具体的并发控制协议来决定事务的执行顺序。然而即使被打断，仍然会保证最终全部执行成功或者全部被回滚。

* 一致性（Consistency）：事务在执行前后，数据库的状态应保持一致。事务必须使数据库从一个一致性状态变换到另一个一致性状态。

* 隔离性（Isolation）：一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。隔离性确保在并发执行的多个事务之间，每个事务看到的数据是独立的，互不干扰，防止并发执行事务时出现一些意外的、不一致的结果。数据库系统通过实现不同的隔离级别来控制事务之间的可见性，从而提供不同程度的隔离性。

* 持久性（Durability）：事务一旦提交，对数据库的修改就是永久性的，即使系统故障也不应该对其有任何影响，持久性确保数据的可靠性和长期保存。

### 事务的隔离级别

隔离性定义了在并发事务之间对数据的可见性（即一个事务的更新数据对另一个事务的可见性），数据库锁就是为了构建这些隔离级别存在的。数据库系统通过实现不同的隔离级别来控制事务之间的可见性，从而提供不同程度的隔离性。隔离级别越高，事务之间的隔离程度越高，但是并发性越低，系统的开销越大。

数据库系统通常实现了以下四种隔离级别：

* 读未提交（Read Uncommitted）：事务中的修改，即使没有提交，对其他事务也是可见的。最低的隔离级别。在这个级别，一个事务可以看到其他事务未提交的修改。

* 读提交（Read Committed）：事务提交后，它的修改才会对其他事务可见。这是大多数数据库系统的默认隔离级别。在这个级别，一个事务只能看到其他事务已提交的修改。

* 可重复读（Repeatable Read）：一个事务在多次执行同一查询时，同一查询将返回相同的结果，即使其他事务对数据进行了修改并提交。

* 串行化（Serializable）：最高级别的隔离，确保事务之间的完全隔离，不允许并发执行。

需要特别注意的是，不同的数据库系统对隔离级别的实现可能不同，例如 MySQL 数据库的可重复读隔离级别与 PostgreSQL 数据库的可重复读隔离级别是不同的，MySQL 数据库的可重复读隔离级别只能保证在同一个事务中多次执行同一查询时，同一查询将返回相同的结果，而 PostgreSQL 数据库的可重复读隔离级别则能保证在不同的事务中多次执行同一查询时，同一查询将返回相同的结果。